#!/usr/bin/env ruby

# frozen_string_literal: true

require 'net/http'
require 'dotenv'
require 'dotenv/load'
require 'json'

Dotenv.load(File.expand_path('../.env', __dir__))

def fetch_weather(city)
  api_key = ENV['OPENWEATHER_API_KEY']
  url = "https://api.openweathermap.org/data/2.5/weather?q=#{city}&units=metric&appid=#{api_key}"
  uri = URI(url)
  response = Net::HTTP.get(uri) # returns a Response object
  JSON.parse(response) # parse Response object to Hash  and returns a hash with all data
end

city = ARGV.join(' ')

weather = fetch_weather(city)

city_name = weather['name']
temp = weather['main']['temp']
weather_description = weather['weather'][0]['description']

puts "City: #{city_name}"
puts "Temperature: #{temp}"
puts "Weather: #{weather_description}"
